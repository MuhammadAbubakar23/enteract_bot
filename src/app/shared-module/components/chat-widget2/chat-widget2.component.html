<body class="agent-grid leftactive">
  <main>
    <div class="main-wrapper d-flex">
      <div class="middle-wrapper d-flex w-100 flex-column">
        <div class="content-box-wrapper d-flex w-100">
          <div class="middle-content d-flex">
            <div *ngIf="!hasParent" class="chatbg" style="
                background: url(../../../../assets/images/chatbg.png) no-repeat
                  top;
              "></div>
            <div class="e-bot-icon" [ngClass]="{ active: isOpen }">
              <div class="e_chat-icon" (click)="openChat()">
                <img src="../../../../assets/Images/ebot.svg" />
              </div>
            </div>
            <div class="enteract-chatbot" [ngClass]="{ active: isOpen, removebot: !isOpen }">
              <div class="e-chat-main">
                <header>
                  <div class="e_chat-icon">
                    <img src="../../../../assets/Images/ebot.svg" />
                  </div>
                  <div>
                    <h4>enteract.bot</h4>
                    <p class="coal">Online</p>
                  </div>
                  <div class="ebotclose mt-2" (click)="closeChat()">
                    <i class="fa-light fa-minus"></i>
                  </div>
                </header>
                <section class="chatbody" #chatBody style="overflow: auto;" #scrollMe
                  [scrollTop]="scrollMe.scrollHeight">
                  <!-- <div class="messagewrap suggestions">
                    <div class="messagebody">
                      <ul class="list-inline text-center m-0">
                        <form [formGroup]="chatForm">
                          <li class="list-inline-item">
                            <span (click)="chatForm.controls['message'].setValue('Good Bye'); submitMessage('/bye')">ðŸš€ Good Bye</span>
                          </li>
                          <li class="list-inline-item">
                            <span (click)="chatForm.controls['message'].setValue('Talk To Human'); submitMessage('/transfer')">ðŸ“© Talk To Human</span>
                          </li>
                        </form>
                      </ul>
                    </div>
                  </div> -->
                  <div class="messagewrap e-left" data-first="true">
                    <div class="messagebody">
                      <div class="caption">
                        <div class="name">
                          <div class="e_chat-icon">
                            <img src="../../../../assets/Images/ebot.svg" />
                          </div>
                          enteract.bot
                        </div>
                        <div class="time">{{getCurrentTime()}}</div>
                      </div>
                      <div class="messagebubble">
                        Hi! I'm enteract.bot ðŸ˜Ž Nice to meet you! ðŸ‘‹ Please don't hesitate to ask us anything or share
                        your feedback.
                      </div>
                      <div class="coal mb-5" *ngIf="isCredentialsEntered == 0"></div>
                      <!-- <div class = "coal mb-5"></div><div class = "coal mb-5"></div> -->
                      <div class="login-form main-login-form agentExtensionWrapper mb-5"
                        *ngIf="isCredentialsEntered == 0">
                        <div class="form w-100">
                          <form [formGroup]="registerForm" (ngSubmit)="submitCredentials()">
                            <div class="form-floating">
                              <h6 class="coal">Please enter full name and email to start chatting!</h6>
                            </div>
                            <div class="form-floating mb-2">
                              <input
                                class="form-control"
                                id="register-username"
                                formControlName="fullName"
                                required
                                [class.is-invalid]="registerForm.controls['fullName'].invalid && registerForm.controls['fullName'].touched"
                                [class.is-valid]="registerForm.controls['fullName'].valid && registerForm.controls['fullName'].touched"
                              />
                              <label for="register-username">Full Name</label>
                              <div class="invalid-feedback">
                                <div *ngIf="registerForm.controls['fullName'].errors?.['required']">
                                  Full Name is required.
                                </div>
                                <div *ngIf="registerForm.controls['fullName'].errors?.['fullNameInvalid'] && registerForm.controls['fullName'].value!=''">
                                  Please enter a valid full name (e.g., "John Doe").
                                </div>
                              </div>
                              <div class="valid-feedback">Looks good!</div>
                            </div>
                            

                            <!-- <div *ngIf="registerForm.get('fullName')?.touched && registerForm.get('fullName')?.invalid" class="alert alert-danger">
                              <div *ngIf="registerForm.get('fullName')?.errors?.['required']">Name is required</div>
                            </div> -->

                            <div class="form-floating mb-2">
                              <input class="form-control" id="register-email" formControlName="email" required
                                type="email"
                                [class.is-invalid]="registerForm.controls['email'].invalid && registerForm.controls['email'].touched"
                                [class.is-valid]="registerForm.controls['email'].valid && registerForm.controls['email'].touched" />
                              <label for="register-email">Email</label>
                              <div class="invalid-feedback">
                                <div *ngIf="registerForm.controls['email'].errors?.['required']">
                                  Email is required.
                                </div>
                              </div>
                              <div class="invalid-feedback">
                                <div *ngIf="registerForm.controls['email'].errors?.['email']">
                                  Please enter a valid email.
                                </div>
                              </div>
                              <div class="valid-feedback">Looks good!</div>
                            </div>
                            <!-- <div *ngIf="registerForm.get('email')?.touched && registerForm.get('email')?.invalid" class="alert alert-danger">
                              <div *ngIf="registerForm.get('email')?.errors?.['required']">Email is required</div>
                              <div *ngIf="registerForm.get('email')?.errors?.['email']">Please enter a valid email</div>
                            </div> -->

                            <div class="form-btn">
                              <button type="submit" class="w-100 btn loginbtn" id="loginBtn" tabindex="-1"
                                role="button">
                                <i class="fas fa-paper-plane-top"></i>
                              </button>
                            </div>

                          </form>



                          <div class="col-12 d-flex justify-content-between mb-4">
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>




                  <div class="messagewrap e-left" data-first="true" *ngIf="isCredentialsEntered == 1">
                    <div class="messagebody">
                      <div class="caption">
                        <div class="name">
                          <div class="e_chat-icon">
                            <img src="../../../../assets/Images/ebot.svg" />
                          </div>
                          enteract.bot
                        </div>
                        <div class="time">{{getCurrentTime()}}</div>
                      </div>
                      <div class="messagebubble">
                        Hello {{currentUserName}}! How can i help you?
                      </div>
                      <div class="coal mb-5"></div>
                    </div>
                  </div>



                  <ng-container *ngFor="let msg of chatMessages; let i = index">
                    <div class="messagewrap" [ngClass]="{
                        'e-right': msg.type === 'human',
                        'e-left': (msg.type === 'ai-agent' || msg.type == 'human-agent')
                      }" [attr.data-first]="msg.type === 'human' ? true : null"
                      [attr.data-last]="(msg.type === 'ai-agent' || msg.type === 'human-agent') ? true : null">
                      <div class="messagebody">
                        <div class="caption">
                          <div class="name">
                            <div *ngIf="msg.type === 'ai-agent' || msg.type == 'human-agent'" class="e_chat-icon">
                              <img src="../../../../assets/Images/ebot.svg" />
                            </div>
                            {{ msg.type === "human" ? "You" : msg.type=== "ai-agent" ? "enteract.bot" : msg.type ===
                            "human-agent"?msg.agent_name || "Human Agent" :"Human Agent"}}
                          </div>
                          <div class="time">
                            {{ msg.timestamp }}

                          </div>
                        </div>
                        <div class="messagebubble">
                          {{ msg.text }}
                        </div>
                      </div>
                    </div>

                  </ng-container>
                  <ng-container>
                    <div *ngIf="typing" class="messagewrap e-left">
                      <div class="messagebody">
                        <div class="caption">
                          <div class="name">
                            <div class="e_chat-icon">
                              <img src="../../../../assets/Images/ebot.svg" />
                            </div>
                            enteract.bot
                          </div>
                          <div class="time">{{ currentTimestamp | date : "shortTime" }}</div>
                        </div>
                        <div class="messagebubble">
                          <div class="typing">
                            <div class="dot"></div>
                            <div class="dot"></div>
                            <div class="dot"></div>
                          </div>
                        </div>
                      </div>
                    </div>
                  </ng-container>

                  <form [formGroup]="chatForm" *ngIf="isCredentialsEntered != 0">
                    <ul class="list-inline d-flex align-items-center justify-content-center listbtns"
                      *ngIf="buttonAlreadyClicked == false">

                      <li class="list-inline-item">
                        <button class="btn btn-white px-3 rounded-pill bg-white "
                          (click)="chatForm.controls['message'].setValue('Good Bye'); submitMessage('/bye')"><i
                            class="fa-solid fa-heart me-2 radical"></i> Good Bye</button>
                      </li>
                      <li class="list-inline-item">
                        <button class="btn btn-white px-3 rounded-pill bg-white "
                          (click)="chatForm.controls['message'].setValue('Talk To Human'); submitMessage('/transfer')"><i
                            class="fa-regular fa-user me-2 "></i> Talk To Human</button>
                      </li>

                    </ul>

                  </form>
                </section>
                <footer *ngIf="conversation_end==0 && isCredentialsEntered != 0">
                  <form [formGroup]="chatForm">
                    <input class="form-control" placeholder="Send a message.." formControlName="message" />
                    <button class="iconButton iconHover sendicon" (click)="submitMessage('')">
                      <i class="fa-light fa-paper-plane-top"></i>
                    </button>
                  </form>
                </footer>

                <footer *ngIf="conversation_end==1">
                  <ul class="list-inline d-flex align-items-center justify-content-center listbtns">
                    <li class="list-inline-item">
                      <div class="justify-content-center">Conversation ended by Agent</div>
                    </li>
                  </ul>

                </footer>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </main>
</body>